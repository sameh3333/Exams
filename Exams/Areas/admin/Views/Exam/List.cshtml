@model List<TbExamDto>
<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <!-- العنوان -->
        <h2 class="text-primary mb-0">Exam List</h2>

        <!-- الأزرار -->
        <div class="d-flex gap-2">
            <a class="btn btn-outline-secondary" asp-controller="Home" asp-action="Index" title="Back to Home">
                <i class="fas fa-arrow-left"></i> Back
            </a>
            <a class="btn btn-success" asp-controller="Exam" asp-action="Edit" title="Add New Exam">
                <i class="fas fa-plus"></i> New Exam
            </a>
        </div>
    </div>

    <div class="card shadow-lg">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover align-middle" id="examTable">
                    <thead class="table-primary">
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Exam Title</th>
                            <th scope="col" class="text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            int index = 1;
                        }
                        @foreach (var exam in Model)
                        {
                            <tr>
                                <td>@index</td>
                                <td class="text-truncate" style="max-width:300px;">@exam.Title</td>
                                <td class="text-center">
                                    <a asp-controller="Exam" asp-action="Edit" asp-route-Id="@exam.Id"
                                       class="btn btn-info btn-sm" title="Edit Exam">
                                        <i class="fas fa-edit">Edit</i>
                                    </a>
                                    <a asp-controller="Question" asp-action="List" asp-route-ExamId="@exam.Id"
                                       class="btn btn-primary btn-sm" title="Add Questions">
                                        <i class="fas fa-list">Add Questions</i>
                                    </a>
                                    <button type="button" class="btn btn-danger btn-sm delete-btn" data-id="@exam.Id" title="Delete Exam">
                                        <i class="fas fa-trash">Delete</i>
                                    </button>
                                </td>
                            </tr>
                            index++;
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>

    <script>
         $(document).ready(function () {
            // ✅ تفعيل DataTables لتحسين تجربة المستخدم
            $('#questionTable').DataTable({
                "paging": true,
                "searching": true,
                "ordering": true,
                "info": true,
                "lengthMenu": [5, 10, 25, 50],
                "language": {
                    "search": "🔍 Search:",
                    "lengthMenu": "Show _MENU_ entries",
                    "zeroRecords": "No questions found",
                    "info": "Showing _START_ to _END_ of _TOTAL_ questions",
                    "infoEmpty": "No questions available",
                    "infoFiltered": "(filtered from _MAX_ total questions)"
                }
            });


            // 🛑 تأكيد الحذف باستخدام SweetAlert2
            $(document).on("click", ".btn-danger.delete-btn", function (e) {
                e.preventDefault();
                var id = $(this).data('id');
                var deleteUrl = '@Url.Action("Delete", "Exam")' + '?id=' + id;

                Swal.fire({
                    title: "Are you sure?",
                    text: "You won't be able to revert this!",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#d33",
                    cancelButtonColor: "#3085d6",
                    confirmButtonText: "Yes, delete it!"
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location.href = deleteUrl;
                    }
                });
            });

            // ✅ عرض التنبيه بناءً على `TempData["MessageType"]`
            var messageType = "@TempData["MessageType"]";
            if (messageType === "1") {
                Swal.fire("Success!", "The exam has been saved successfully.", "success");
            } else if (messageType === "2") {
                Swal.fire("Error!", "Failed to save the exam.", "error");
            } else if (messageType === "3") {
                Swal.fire("Deleted!", "The exam has been deleted.", "success");
            } else if (messageType === "4") {
                Swal.fire("Error!", "Failed to delete the exam.", "error");
            }
        });
    </script>
}
